---
import Icon from "./Icon.astro";

// No props or imports needed for this component
---

<button class="theme-toggle" aria-label="Toggle theme">
  <span class="icon sun"><Icon icon="sun" display="inline-block"/></span>
  <span class="icon moon"><Icon icon="moon-star" display="inline-block"/></span>
</button>

<style lang="scss">
  @use "../../styles/abstracts/" as *;
  .theme-toggle {
    --_background: var(--clr-background-theme-toggle, #{$color-background-theme-toggle});
    --icon-size: 20px;
    border: 0;
    border-radius: 50%;
    background: var(--_background);
    cursor: pointer;
    padding: 10px 12px;
  }
  .sun { 
    display: block;
    color: black;
  }
  .moon { 
    display: none;
   }
  
  :global(.theme-dark) .sun { display: none; }
  :global(.theme-dark) .moon { 
    display: block;
    color: white;
  }
</style>

<script>
  const theme = (() => {
    if (typeof window.localStorage !== 'undefined' && window.localStorage.getItem('theme')) {
      return localStorage.getItem('theme');
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    return 'light';
  })();
      
  if (theme === 'light') {
    document.documentElement.classList.remove('theme-dark');
  } else {
    document.documentElement.classList.add('theme-dark');
  }

  window.localStorage.setItem('theme', theme || 'light');

  const handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle("theme-dark");

    const isDark = element.classList.contains("theme-dark");
    window.localStorage.setItem("theme", isDark ? "dark" : "light");
    console.log(localStorage.getItem("theme"));
  }

  document.addEventListener("DOMContentLoaded", () => {
    const themeToggles = document.querySelectorAll(".theme-toggle");
    themeToggles.forEach(toggle => {
      toggle.addEventListener("click", handleToggleClick);
    });
  });
</script>
