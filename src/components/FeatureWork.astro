---
import Cta from './composable/Cta.astro';
import HighlightHeading from './composable/HighlightHeading.astro';
import { getImage, Image } from 'astro:assets';

interface Props {
  class?: string;
  work: {
    data: {
      eyebrow: string;
      title: string;
      description: string;
      feature_image: {
        src: string;
        alt: string;
      };
      url: string;
      keywords: string[];
      enable_case_study: boolean;
      theme: "primary" | "secondary" | "tertiary" | "quaternary";
    };
    slug: string;
  }
}

const { class: className, work }: Props = Astro.props;
const { eyebrow, title, feature_image, url, keywords = [], enable_case_study, theme } = work.data;

// Dynamically import the image
const imageModule = await import(`../assets${feature_image.src}`);
---
<div class:list={[className, "featured-work-container"]}>
  <div class="featured-work">
    <div class="featured-work__image">
      <Image src={imageModule.default} alt={feature_image.alt} format='avif' quality={"mid"} />
    </div>
    <div class="featured-work__content">
      <h4 class="eyebrow">{eyebrow}</h4>
      <HighlightHeading title={title} type={theme} level={3} class="h4" />
      {keywords.length > 0 && (
        <ul class="tags featured-work__tags">
          {keywords.map(keyword => (
            <li>{keyword}</li>
          ))}
        </ul>
      )}
    </div>
    <div class:list={[className, "featured-work__ctas"]}>
      {enable_case_study && <Cta href={`/case-study/${work.slug}`} type="primary">View Case Study</Cta>}
      {url && <Cta href={url} type="secondary">See Live</Cta>}
    </div>
  </div>
</div>
<style lang="scss">
  @use "../styles/abstracts/" as *;
  
  .featured-work-container {
    container-type: inline-size;
  }

  .span-2 {
    .featured-work__image {
      aspect-ratio: 16 / 7;
    }
  }

  .featured-work {
    display: grid;
    gap: $size-8;

    &__image {
      aspect-ratio: 4 / 3;
      overflow: hidden;
      border-radius: var(--border-radius-2, $border-radius-2);

      img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
      }
    }

    &__tags {
      margin-block-start: $size-6;
    }

    &__ctas {
      display: flex;
      flex-direction: column;
      gap: $size-4;
    }

    @include mq(m) {
      &__ctas {
        align-items: end;
        display: flex;
        flex-direction: row;
        gap: $size-4; 
      } 
    }

    @container (width > 940px) {
      grid-template-columns: 5fr 3fr;

      &__image {
        grid-column: span 2;
      }

      &__ctas {
        justify-content: flex-end;
      }
    }
  }
</style>